<!DOCTYPE html><html lang="en"><head><meta name="author" content="moondaddi"/><link rel="manifest" href="/static/manifest.json"/><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Merriweather" rel="stylesheet"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Build my dreams with codes"/><meta name="theme-color" content="black"/><meta charSet="utf-8" class="next-head"/><title class="next-head">Build the Codes</title><link rel="preload" href="/_next/static/xfhpDKqUyHy6HIgQkDi1L/pages/post.js" as="script"/><link rel="preload" href="/_next/static/xfhpDKqUyHy6HIgQkDi1L/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-838b392324e3598684b5.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.4860be0a2558b214ee9b.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.a44caf2ce2cc4614b00a.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-e66313a3e9b5d14075c9.js" as="script"/><link rel="stylesheet" href="/_next/static/css/styles.0c6a08f2.chunk.css"/></head><body><div id="__next"><div id="header"><div class="container"><div class="header-container"><div id="header-title"><a href="/">Build the Codes</a></div><div><div id="avatar-img" style="background-image:url(&quot;/static/images/avatar/moondaddi_avatar.jpg&quot;)"></div><div id="profile"><div id="name"><a href="/about/">moondaddi</a></div><div>My dreams with Codes</div></div><div id="menu"><div id="header-tag"><a href="/tag/">Tags</a></div><div id="header-about"><a href="/about/">About</a></div></div></div></div></div></div><div id="content"><div class="container"><div class="post-card"><div><h1>How to set state with data from apollo grapqhQL query</h1><p>by Moondaddi on 2018-09-08</p><hr/><h2>Prefill the form with query data</h2><ul><li>prefill values into form or render data into DOM after query</li><li>modify data after query</li></ul><br/><h2>Solution 1</h2><h3>in componentDidMount()</h3><pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> { Query } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-apollo&quot;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  state = {
    <span class="hljs-attr">some</span>: <span class="hljs-literal">null</span>
  };

  componentDidMount() {
    <span class="hljs-keyword">this</span>._queryMe
      .query({
        <span class="hljs-attr">query</span>: other - query,
        <span class="hljs-attr">variables</span>: { <span class="hljs-attr">some</span>: thing }
      })
      .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({
          <span class="hljs-attr">some</span>: data.me.nickname
        });
      })
      .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(error));
  }

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Query</span> <span class="hljs-attr">query</span>=<span class="hljs-string">{some</span> <span class="hljs-attr">-</span> <span class="hljs-attr">query</span>}&gt;</span>
        {({ client }) =&gt; {
          this._queryMe = client;

          return null;
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Query</span>&gt;</span></span>
    );
  }
}</code></pre><h3>props function : onCompleted</h3><pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> { Query } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-apollo&#x27;</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  state = {
    <span class="hljs-attr">some</span>: <span class="hljs-literal">null</span>
  }

  _queryMe = <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>.setState({
      <span class="hljs-attr">some</span>: data
    })
  }

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Query</span>
        <span class="hljs-attr">query</span>=<span class="hljs-string">{some-query}</span>
        <span class="hljs-attr">onCompleted</span>=<span class="hljs-string">{data</span> =&gt;</span> this.\_queryMe(data)}
      &gt;
        {() =&gt; {
          return null;
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Query</span>&gt;</span></span>
    )
  }
}</code></pre><br/><h2>Solution 2 (The BEST üëç)</h2><p>Using HOC withApollo</p><pre><code class="hljs language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  state = {
    <span class="hljs-attr">some</span>: <span class="hljs-literal">null</span>
  };

  componentDidMount() {
    <span class="hljs-keyword">this</span>.props.client
      .query({
        <span class="hljs-attr">query</span>: some_query,
        <span class="hljs-attr">variables</span>: {
          <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>
        }
      })
      .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span>
        <span class="hljs-keyword">this</span>.setState({
          <span class="hljs-attr">some</span>: res
        })
      );
  }

  render() {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
}

<span class="hljs-comment">// using HOC</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withApollo(Example);</code></pre></div></div></div></div><div id="footer"><div class="container"><div class="footer-container"><div id="footer-github"><a href="https://github.com/mattdamon108" target="_blank">Github</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/post","query":{"filename":"2018-09-08-How-to-set-state-with-data-from-graphQL-query"},"buildId":"xfhpDKqUyHy6HIgQkDi1L","nextExport":true}</script><script async="" id="__NEXT_PAGE__/post" src="/_next/static/xfhpDKqUyHy6HIgQkDi1L/pages/post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/xfhpDKqUyHy6HIgQkDi1L/pages/_app.js"></script><script src="/_next/static/runtime/webpack-838b392324e3598684b5.js" async=""></script><script src="/_next/static/chunks/commons.4860be0a2558b214ee9b.js" async=""></script><script src="/_next/static/chunks/styles.a44caf2ce2cc4614b00a.js" async=""></script><script src="/_next/static/runtime/main-e66313a3e9b5d14075c9.js" async=""></script></body></html>