{"version":3,"file":"static/webpack/static/development/pages/post.js.9e0d81fb3e78f5e744c5.hot-update.js","sources":["webpack:///./posts/2018-08-28-File-upload-with-GraphQL-Apollo-Client-Django-Graphene.md"],"sourcesContent":["\n  import React from 'react'\n  import { MDXTag } from '@mdx-js/tag'\n  \n\nconst layoutProps = {\n  \n};\nexport default class MDXContent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.layout = null\n  }\n  render() {\n    const { components, ...props } = this.props\n\n    return <MDXTag\n             name=\"wrapper\"\n             \n             components={components}><MDXTag name=\"h1\" components={components}>{`File upload with GraphQL Apollo client & Django + Graphene`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`by Moondaddi on 2018-08-28`}</MDXTag>\n<MDXTag name=\"hr\" components={components}></MDXTag>\n<MDXTag name=\"h2\" components={components}>{`Requirements`}</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"hljs language-shell\"}}><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-meta\"}}>{`$`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"bash\"}}>{` pip install django`}</MDXTag>{`\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-meta\"}}>{`$`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"bash\"}}>{` pip install graphene_django`}</MDXTag>{`\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-meta\"}}>{`$`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"bash\"}}>{` pip install graphene-file-upload`}</MDXTag>{`\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-meta\"}}>{`$`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"bash\"}}>{` pip install python-resize-image`}</MDXTag></MDXTag></MDXTag>\n<MDXTag name=\"ul\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`Django==2.0.7`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`graphene==2.1.2`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`graphene-django==2.0.0`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`graphene-file-upload==1.0.0`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`graphql-core==2.0`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`graphql-relay==0.4.5`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`python-resize-image==1.1.11`}</MDXTag>\n</MDXTag>\n<br />\n<MDXTag name=\"h2\" components={components}>{`Backend`}</MDXTag>\n<MDXTag name=\"blockquote\" components={components}>\n<MDXTag name=\"p\" components={components} parentName=\"blockquote\">{`Mutation part`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"hljs language-python\"}}><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`import`}</MDXTag>{` graphene\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`from`}</MDXTag>{` graphene_django `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`import`}</MDXTag>{` DjangoObjectType\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`from`}</MDXTag>{` graphene_file_upload.scalars `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`import`}</MDXTag>{` Upload\n\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-class\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-keyword\"}}>{`class`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-title\"}}>{`CUDNewsBoard`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-params\"}}>{`(graphene.Mutation)`}</MDXTag>{`:`}</MDXTag>{`\n  newsboard = graphene.Field(NewsBoardType)\n\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-class\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-keyword\"}}>{`class`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-title\"}}>{`Arguments`}</MDXTag>{`:`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-comment\"}}>{`# other arguments up here...`}</MDXTag>{`\n  files = Upload()\n\n  `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-function\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-keyword\"}}>{`def`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-title\"}}>{`mutate`}</MDXTag><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-params\"}}>{`(self, info, files=None, ...)`}</MDXTag>{`:`}</MDXTag>{`\n    user = info.context.user\n\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`if`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`not`}</MDXTag>{` user.is_staff:\n      `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`raise`}</MDXTag>{` Exception(`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-string\"}}>{`'Admin permission is required!'`}</MDXTag>{`)\n\n    post = NewsBoard(user=user, title=title, content=content)\n    post.save()\n\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`if`}</MDXTag>{` files:\n      `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`for`}</MDXTag>{` file `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`in`}</MDXTag>{` files:\n\n        postimage = NewsBoardImage(post=post, image=`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`None`}</MDXTag>{`)\n        postimage.save()\n\n        image_obj = Image.open(file)\n        `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-comment\"}}>{`# resize image`}</MDXTag>{`\n        image_obj = resizeimage.resize_width(image_obj, `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-number\"}}>{`800`}</MDXTag>{`, validate=`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`False`}</MDXTag>{`)\n\n        new_image_io = BytesIO()\n        image_obj.save(new_image_io, image_obj.format)\n\n        temp_name = file.name\n\n        postimage.image.save(\n          temp_name,\n          content=ContentFile(new_image_io.getvalue())\n        )\n\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`return`}</MDXTag>{` CUDNewsBoard(newsboard=post)`}</MDXTag></MDXTag>\n<br />\n<MDXTag name=\"h2\" components={components}>{`Frontend`}</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"hljs language-javascript\"}}><MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`const`}</MDXTag>{` NEW_POST_NEWS = gql`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-string\"}}>{`\\`\nmutation postNew($files: Upload, ...) {\n  cudNewsboard(files: $files, ...) {\n    newsboard {\n      id\n      user {\n        id\n        fullname\n      }\n      title\n      content\n      firstDate\n      views\n      likes {\n        id\n      }\n      newsboardimages {\n        id\n        image\n      }\n    }\n  }\n}\n\\``}</MDXTag>{`;\n\n`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-class\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-keyword\"}}>{`class`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-title\"}}>{`BoardNewsInput`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-keyword\"}}>{`extends`}</MDXTag>{` `}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-title\"}}>{`Component`}</MDXTag>{` `}</MDXTag>{`{\n  state = {\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-attr\"}}>{`images`}</MDXTag>{`: []\n  };\n\n  render() {\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`return`}</MDXTag>{` (\n      `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"xml\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-tag\"}}>{`<`}<MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-name\"}}>{`div`}</MDXTag>{`>`}</MDXTag>{`\n        `}</MDXTag>{`<input\n          type=\"file\"\n          name=\"image\"\n          onChange={({\n            target: {\n              validity,\n              files: [file]\n            }\n          }) =>\n            validity.valid &&\n            this.setState({\n              images: [...this.state.images, file]\n            })\n          }\n        />\n        <Mutation\n          mutation={NEW_POST_NEWS}\n          variables={{\n            files: this.state.images ? this.state.images : null\n          }}\n        >\n          {(cudNewsboard, { loading, error, data }) => (\n            <button\n              onClick={() => {\n                cudNewsboard();\n              }}\n            >\n              POST\n            </button>\n          )}\n        </Mutation>\n      </div>`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"xml\"}}>{`\n    );\n  }\n}`}</MDXTag></MDXTag></MDXTag>\n<br />\n<MDXTag name=\"h2\" components={components}>{`Lesson & Learn`}</MDXTag>\n<MDXTag name=\"ol\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ol\">{`Array can be substitutive for FileList object in this case.`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"hljs language-javascript\"}}>{`state = {\n  `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-attr\"}}>{`images`}</MDXTag>{`: [file, file, file, ...]\n}`}</MDXTag></MDXTag>\n<br />\n<MDXTag name=\"ol\" components={components} props={{\"start\":2}}>\n<MDXTag name=\"li\" components={components} parentName=\"ol\">{`Input onChange method`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"pre\" components={components}><MDXTag name=\"code\" components={components} parentName=\"pre\" props={{\"className\":\"hljs language-javascript\"}}>{`<input\n  onChange={({ validity, `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-attr\"}}>{`files`}</MDXTag>{`: [file] }) =>\n    validity.valid &&\n    `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-keyword\"}}>{`this`}</MDXTag>{`.setState(`}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-function\"}}><MDXTag name=\"span\" components={components} parentName=\"span\" props={{\"className\":\"hljs-params\"}}>{`prevState`}</MDXTag>{` =>`}</MDXTag>{` {\n      `}<MDXTag name=\"span\" components={components} parentName=\"code\" props={{\"className\":\"hljs-attr\"}}>{`images`}</MDXTag>{`: [...prevState.images, file];\n    })\n  }\n/>`}</MDXTag></MDXTag>\n<br />\n<MDXTag name=\"h2\" components={components}>{`References`}</MDXTag>\n           </MDXTag>\n  }\n}\nMDXContent.isMDXComponent = true\n  "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AAGA;AACA;AAEA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAGA;AACA;;;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AAHA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAEA;;;;AAtKA;AACA;AADA;AAwKA;;;;A","sourceRoot":""}